===============================================================================

　簡易アップローダー

===============================================================================


■ソフトの概要

　シンプルなアップローダー（として動作するサーバー）です。
　ブラウザを使用してファイルのアップロードとダウンロードを行えます。
　アップロードしたファイルは特定のフォルダにそのまま出力されるので、
　ローカルから直接または共有フォルダ越しに触ることもできます。

　特定のIPをブロックしたり、一定時間内のアップロード回数を制限するなどのアクセス制限は掛けられないため、
　荒らし行為などには対抗できません。仲間内でこっそり運用するか、ＬＡＮ内での利用をおすすめします。


■動作環境

　Windows 10
　確認していませんが Windows 7/8/8.1 でも動くかもしれません。

　.NET Framework 4 を使用します。


■インストール方法

　アーカイブの中身をローカルディスク上の任意の場所にコピーして下さい。


■アンインストール方法

　レジストリなどは一切使っていません。
　ファイルを削除するだけでアンインストールできます。


■使い方

　Uploader.exe を実行するとサーバーが起動します。

　ブラウザから http://localhost/ を開いてみて下さい。
　「簡易アップローダー」というタイトルのページが表示されたら起動は成功です。


　●メニューの説明

　　アプリケーション / 開始 ... 停止したサーバーを再起動します。
　　アプリケーション / 停止 ... サーバーを停止します。
　　アプリケーション / 終了 ... サーバーを停止して、プログラムを終了します。
　　設定 / 設定             ... 設定ウィンドウを開きます。(設定ウィンドウを開いている間、サーバーは停止します)


　●設定

　　ポート番号               ... 待ち受けポート番号です。
　　ファイル合計サイズの上限 ...

　　　アップロード先フォルダ内のファイルの合計サイズがこの値を上回らないよう、
　　　アップロード先フォルダ内の〈更新日時が最も古いファイルから〉削除して調整します。

　　確保するディスクの空き領域 ...

　　　アップロード先フォルダに指定されたドライブの空き領域がこの値を下回らないよう、
　　　アップロード先フォルダ内の〈更新日時が最も古いファイルから〉削除して調整します。

　　ファイル数の上限 ...

　　　アップロード先フォルダ内のファイル数の上限です。
　　　アップロード先フォルダ内の古いファイルを削除して調整します。

　　アップロード先フォルダ ...

　　　アップロードしたファイルを格納するフォルダです。
　　　このフォルダ内のファイルは、ディスクの空き領域の調整などの理由で勝手に削除されることがあるのでご注意下さい。

　　画像を表示する            ... 画像ファイルをファイルリストに画像として表示するか指定します。
　　画像(累計)サイズの上限    ... 表示する画像ファイルの累計サイズがこの値を越えないように画像数を調整します。
　　画像ファイルの拡張子      ... 画像ファイルの拡張子を半角ピリオドで区切って指定します。
　　日付をＹＭＤで表記する    ... ファイルリスト内の日付をＹＭＤで表記します。
　　削除ボタンを表示する      ... ファイルリストにファイルの削除ボタンを表示します。

　　パスワード ...

　　　アップロードと削除にパスワードを掛けます。
　　　平文でやりとりしてるのでセキュリティ的には子供だましレベルです。
　　　ダウンロードは誰でも普通に出来ます。

　　上書き禁止 ...

　　　以下のようになります。
　　　1. アップロードしたファイル名が既存のファイル名と被った場合、アップロードしたファイル名を変更する。
　　　2. アップロードしたファイル名がフォルダと被った場合、アップロードが失敗する。
　　　3. ファイル数・容量オーバーになる場合、アップロードが失敗する。

　　　※削除ボタンを表示するにして削除ボタン押すと、上書き禁止であってもファイルを削除できることに注意して下さい。

　　ソートオーダー ...

　　　index.htm のファイルの並び方を指定します。

　　　新しい→古い, 古い→新しい は〈作成日時・更新日時の新しい方〉の降順, 昇順
　　　新しい→古い 更新日時, 古い→新しい 更新日時 は 更新日時 の降順, 昇順

　　favicon.ico アップロード禁止

　　　favicon.ico という名前のファイルをアップロードしようとすると favicon.ico_ という名前に変更させられます。


　●サイズ制限・ファイル数制限によるファイル削除について

　　アップロード完了時、及び index.htm 更新直前に〈以下の「条件」を満たす間、以下の「処理」を繰り返し実行〉します。

　　　条件

　　　　現在のファイル数が１以上で、以下の何れかを満たす。

　　　　　〈ファイル合計サイズの上限〉より現在のファイル合計サイズの方が大きい
　　　　　〈確保するディスクの空き領域〉より現在のディスクの空き領域の方が小さい
　　　　　〈ファイル数の上限〉より現在のファイル数の方が多い

　　　処理

　　　　〈作成日時・更新日時の新しい方〉が、最も古いファイルを１つ削除する。


　●その他

　　index.htm のファイルの日時は〈作成日時・更新日時の新しい方〉です。

　　何かページが変だなと思ったら、とりあえず〈アップロード / リスト更新〉を押してみて下さい。


■制限

　本プログラム起動時に以下の条件を満たす必要があります。

　　物理メモリの空き　２００ＭＢ以上
　　物理メモリの空き　２０パーセント以上
　　ハードディスクの空き領域　２ＧＢ以上　※1

　以下のいずれかの状態になると、新しい接続を制限します。

　　物理メモリの空き　残り１５０ＭＢ以下
　　物理メモリの空き　残り１５パーセント以下
　　ハードディスクの空き領域　残り１．５ＧＢ以下　※1

　以下のいずれかの状態になると、全ての接続を切断して待機状態になります。

　　物理メモリの空き　残り１００ＭＢ以下
　　物理メモリの空き　残り１０パーセント以下
　　ハードディスクの空き領域　残り１ＧＢ以下　※1

　同じＩＰアドレスからの最大同時接続を２０に制限しています。


　巨大なファイルをアップロードした場合、リクエストの送信が完了してからレスポンスを受信し始めるまでに、
　数秒〜数分（或いはそれ以上）掛かることがあり、この間は他のクライアントからのリクエストも待機させられます。
　これは単純にサーバーのクリティカルな処理が重いためで、リクエストサイズに比例して処理時間が長くなります。

　ファイルをアップロードするには【アップロードファイルサイズ × ２ ＋ ２ＧＢ】程度の空き領域が一時的に必要です。※1
　必要な空き領域が不足していると、アップロードは失敗します。
　巨大なファイルをアップロードする際はご注意下さい。
　なお、２ＧＢはマージンです。実際に使用するのは【アップロードファイルサイズ × ２】程度です。
　空き領域が１ＧＢを下回ると全ての接続は強制的に切断されるので、ディスクがパンクすることはありません。


　※1 環境変数 TMP が指すドライブ


■取り扱い種別

　フリーソフト


■作者への連絡先

　stackprobes@gmail.com

　バグや要望などご連絡ください。

